<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Expense Manager</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
        }

        .card {
            border-radius: 12px;
        }

        .modal-content {
            border-radius: 12px;
        }

        .btn-rounded {
            border-radius: 30px;
        }
    </style>
</head>

<body>

    <div class="container mt-5">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">Expense Tracker</h2>

        </div>
        <div class="d-flex justify-content-end mb-3">
            <a th:href="@{/api/expenses/download/csv}" class="btn btn-success me-2">
                Download CSV
            </a>
        </div>

        <div class="card shadow-sm">

            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Your Expenses</h5>
            </div>
            <!-- FILTERS SECTION -->
            <form class="card p-3 mb-4 shadow-sm" th:action="@{/api/expenses/filter}" method="get">

                <div class="row g-3">

                    <!-- Search -->
                    <div class="col-md-4">
                        <label class="form-label">Search (Title / Description)</label>
                        <input type="text" class="form-control" name="keyword" th:value="${keyword}">
                    </div>

                    <!-- Month -->
                    <div class="col-md-2">
                        <label class="form-label">Month</label>
                        <select class="form-select" name="month">
                            <option value="">All</option>
                            <option th:each="m : ${#numbers.sequence(1,12)}" th:value="${m}" th:text="${m}"
                                th:selected="${m == month}"></option>
                        </select>
                    </div>

                    <!-- Year -->
                    <div class="col-md-2">
                        <label class="form-label">Year</label>
                        <select class="form-select" name="year">
                            <option value="">All</option>
                            <option th:each="y : ${years}" th:value="${y}" th:text="${y}" th:selected="${y == year}">
                            </option>
                        </select>
                    </div>

                    <!-- Category Filter -->
                    <div class="col-md-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" name="categoryId">
                            <option value="">All</option>
                            <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.name}"
                                th:selected="${c.id == categoryId}"></option>
                        </select>
                    </div>

                    <!-- Search Button -->
                    <div class="col-md-1 d-flex align-items-end">
                        <button class="btn btn-primary w-100">Go</button>
                    </div>

                </div>

            </form>

            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Title</th>
                            <th>Amount</th>
                            <th>Category</th>
                            <th>Date</th>
                            <th>Description</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr th:each="expense : ${expenses}">
                            <td th:text="${expense.title}"></td>
                            <td th:text="${expense.amount}"></td>
                            <td th:text="${expense.category.name}"></td>
                            <td th:text="${expense.date}"></td>
                            <td th:text="${expense.description}"></td>

                            <td class="text-end">

                                <a class="btn btn-sm btn-warning" th:href="@{'/api/expenses/edit/'+ ${expense.id}}">
                                    Edit
                                </a>

                                <a th:href="@{'/api/expenses/delete/' + ${expense.id}}" class="btn btn-sm btn-danger"
                                    onclick="return confirm('Are you sure you want to delete this expense?')">
                                    Delete
                                </a>
                            </td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>

        <div class="text-center mt-4">
            <a class="btn btn-primary" th:href="@{/user/dashboard}">Back</a>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let editModal = document.getElementById("editExpenseModal");

        editModal.addEventListener("show.bs.modal", function (event) {
            let button = event.relatedTarget;

            document.getElementById("edit-id").value = button.getAttribute("data-id");
            document.getElementById("edit-title").value = button.getAttribute("data-title");
            document.getElementById("edit-amount").value = button.getAttribute("data-amount");
            document.getElementById("edit-desc").value = button.getAttribute("data-desc");
            document.getElementById("edit-category").value = button.getAttribute("data-category");
        });
    </script>

</body>

</html>